{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 944c112cae68ac02078e","webpack:///./src/SseDecoder.js"],"names":["lineFeed","constructor","decode","hasBom","bom","pos","lineLength","fieldLength","i","c","latestResults","results","parseEventStreamLine","type","data","lastEventId","origin","url","noValue","step","field","buf","valueLength","value","retry","parseInt","Number","self"],"mappings":"AAAA,eACA,iDADA,CAEA,kBAFA,CAGA,qCAHA,CAIA,iCAJA,CAKA,wBALA,CAMA,iCANA,CAQA,2BACC,CATD,EASC,kCATD,CASC,WACD,M,aCNA,cAGA,QACA,oBAGA,YACA,GADA,CAEA,IAFA,CAGA,UAHA,EAaA,MANA,mCAMA,CAHA,MAGA,UACA,CAxBA,SA4DA,MAhCA,MAgCA,CA7BA,KA6BA,CA1BA,oBACA,QADA,EAEA,2BACA,eADA,CAEA,aAFA,CAGA,KAHA,EAMA,CAkBA,CAfA,gBACA,sBACA,WAA2B,mBAA4B,CADvD,CAEA,WAAiC,QAAe,CAFhD,CAIA,MADA,aACA,EACA,CASA,CANA,kBAAsD,gDAA+D,CAMrH,CAHA,MAGA,S,gECvDA,aAAsB,CACpB,MAAO,SAAU,aAA2B,CAC1C,eADF,CAAO,CAGR,C,sDAVD,yB,CAGMA,EAAN,I,CASe,OAAiB,CAC9BC,cAAkB,CAChB,UADgB,CAEhB,eAFgB,CAGhB,eAHgB,CAIhB,8BAJgB,CAKhB,YALgB,CAMhB,iBACD,CAEDC,SAAe,CACb,SAEA,SAAW,SAAW,KAAtB,GAAsB,EAAX,EAHE,CAIT,cAAgBC,EAAO,KAA3B,GAAoBA,CAJP,GAKX,SAAW,eAAeC,EAA1B,MAAW,CALA,EAQb,eARa,CASb,GAAIC,GAAJ,EATa,KAWNA,EAAM,SAAb,MAXa,EAWiB,CACxB,KAAJ,sBAD4B,GAEtB,KAAJ,GAAI,OAFsB,EAGxB,GAHwB,CAK1B,8BAL0B,EAQ5B,GAAIC,GAAa,CAAjB,EACA,GAAIC,GAAc,CAAlB,EAEA,IAAK,GAAL,KAAkBD,KAAkBE,EAAI,SAAxC,WAA8D,CAC5D,KAAMC,GAAI,KAAV,GAAU,GAAV,CACA,IA7CR,GA2CoE,CAG1D,CAAIF,EAHsD,GAIxDA,KAJwD,EAMrD,IA9Cf,IAwCoE,EAO1D,8BAP0D,CAQ1DD,KAR0D,EASrD,KATqD,GAU1DA,KAV0D,CAY7D,CAED,IAAIA,EAAJ,CACE,MAGF,KAAMI,GAAgB,0BAA0B,KAAhD,GAAsB,OAAtB,CACAC,EAAUA,EAAVA,MAAUA,GA9BkB,CAgC5BN,GAAOC,EAAPD,CACD,CAQD,MANIA,KAAQ,SAAZ,MAMA,CALE,SAAW,IAAX,EAKF,CAJO,CAAIA,EAIX,GAHE,SAAW,SAAX,KAAW,GAGb,GACD,CAEDO,6BAAyD,CACvD,WAEA,IAAIN,IAAJ,CACE,CAAI,iBADN,GAEIK,OAAa,CACXE,KAAM,gBADK,UAEXC,KAAM,kBAAmB,CAFd,CAEL,CAFK,CAGXC,YAAa,KAHF,YAIXC,OAAQ,KAAKC,GAJF,CAAbN,CAFJ,CAQI,YARJ,EAUE,mBAVF,KAWO,KAAIJ,EAAJ,CAAqB,CAC1B,KAAMW,GAAN,CAAgBX,EAAhB,CACA,GAAIY,GAAJ,EACA,KAAMC,GAAQC,UAAehB,GAAfgB,KAAehB,CAAfgB,EAAd,QAAcA,EAAd,CAH0B,MAOfA,EAAIhB,IAAR,CAAIgB,IAhGjB,GAyFgC,CAUjBd,EAAPY,CAVwB,CAQjBZ,EAAPY,CARwB,CAY1Bd,IAZ0B,MAcpBiB,GAAN,GAd0B,CAepBC,EAAQF,eAAd,QAAcA,EAfY,CAiB1B,SAAID,IAAJ,CACE,WAAaG,EAAb,IADF,KAEO,WAAIH,IAAJ,CACL,gBADK,KAEA,QAAIA,IAAJ,CACL,kBADK,KAEA,WAAIA,IAAJ,CAAuB,CAC5B,GAAII,GAAQC,WAAZ,EAAYA,CAAZ,CACKC,OAAL,KAAKA,GAFuB,GAG1BC,wBAH0B,CAK7B,CACF,CAED,QACD,CA/G6B,C,4CFZhC,C","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"barejs-sse-decoder\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"barejs-sse-decoder\"] = factory();\n\telse\n\t\troot[\"barejs-sse-decoder\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 944c112cae68ac02078e","const bom = ['\\xEF', '\\xBB', '\\xBF']\nconst colon = ':'\nconst space = ' '\nconst lineFeed = '\\n'\nconst carriageReturn = '\\r'\n\nfunction hasBom (buf) {\n  return bom.every(function (charCode, index) {\n    return buf[index] === charCode\n  })\n}\n\nexport default class SseDecoder {\n  constructor (url) {\n    this.url = url\n    this.isFirst = true\n    this.buf = undefined\n    this.discardTrailingNewline = false\n    this.data = ''\n    this.eventName = ''\n  }\n\n  decode (chunk) {\n    let results = []\n\n    this.buf = this.buf ? this.buf + chunk : chunk\n    if (this.isFirst && hasBom(this.buf)) {\n      this.buf = this.buf.slice(bom.length)\n    }\n\n    this.isFirst = false\n    let pos = 0\n\n    while (pos < this.buf.length) {\n      if (this.discardTrailingNewline) {\n        if (this.buf[pos] === lineFeed) {\n          ++pos\n        }\n        this.discardTrailingNewline = false\n      }\n\n      let lineLength = -1\n      var fieldLength = -1\n\n      for (let i = pos; lineLength < 0 && i < this.buf.length; ++i) {\n        const c = this.buf[i]\n        if (c === colon) {\n          if (fieldLength < 0) {\n            fieldLength = i - pos\n          }\n        } else if (c === carriageReturn) {\n          this.discardTrailingNewline = true\n          lineLength = i - pos\n        } else if (c === lineFeed) {\n          lineLength = i - pos\n        }\n      }\n\n      if (lineLength < 0) {\n        break\n      }\n\n      const latestResults = this.parseEventStreamLine(this.buf, pos, fieldLength, lineLength)\n      results = results.concat(latestResults)\n\n      pos += lineLength + 1\n    }\n\n    if (pos === this.buf.length) {\n      this.buf = void 0\n    } else if (pos > 0) {\n      this.buf = this.buf.slice(pos)\n    }\n\n    return results\n  }\n\n  parseEventStreamLine (buf, pos, fieldLength, lineLength) {\n    const results = []\n\n    if (lineLength === 0) {\n      if (this.data.length > 0) {\n        results.push({\n          type: this.eventName || 'message',\n          data: this.data.slice(0, -1), // remove trailing newline\n          lastEventId: this.lastEventId,\n          origin: this.url\n        })\n        this.data = ''\n      }\n      this.eventName = null\n    } else if (fieldLength > 0) {\n      const noValue = fieldLength < 0\n      let step = 0\n      const field = buf.slice(pos, pos + (noValue ? lineLength : fieldLength)).toString()\n\n      if (noValue) {\n        step = lineLength\n      } else if (buf[pos + fieldLength + 1] !== space) {\n        step = fieldLength + 1\n      } else {\n        step = fieldLength + 2\n      }\n      pos += step\n\n      const valueLength = lineLength - step\n      const value = buf.slice(pos, pos + valueLength).toString()\n\n      if (field === 'data') {\n        this.data += value + '\\n'\n      } else if (field === 'event') {\n        this.eventName = value\n      } else if (field === 'id') {\n        this.lastEventId = value\n      } else if (field === 'retry') {\n        var retry = parseInt(value, 10)\n        if (!Number.isNaN(retry)) {\n          self.reconnectInterval = retry\n        }\n      }\n    }\n\n    return results\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/SseDecoder.js"],"sourceRoot":""}